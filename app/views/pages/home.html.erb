<h1>Satellites Nearby</h1>

<!-- Map container -->
<div id="map" style="width: 100%; height: 500px;"></div>

<script>
  // Replace with your Mapbox API access token
  mapboxgl.accessToken = "<%= @mapbox_token %>";

  // Initialize the map
  const map = new mapboxgl.Map({
    container: 'map', // container ID
    style: 'mapbox://styles/mapbox/streets-v11', // style URL
    center: [16.931992, 52.409538], // starting position [lng, lat]
    zoom: 5 // starting zoom level
  });

  // Add map controls
  map.addControl(new mapboxgl.NavigationControl());

  // Satellite data from Ruby controller
  const satellites = <%= raw @satelites_list.to_json %>;
  console.log(satellites);

  if (satellites && satellites.length > 0) {
    satellites.forEach((satellite) => {
      console.log(`Adding marker for satellite: ${satellite.satname} at coordinates: (${satellite.observer_lng}, ${satellite.observer_lat})`);

      new mapboxgl.Marker({ color: "red" }) // Customize marker color
        .setLngLat([satellite.observer_lng, satellite.observer_lat]) // Ensure correct order
        .setPopup(new mapboxgl.Popup().setText(satellite.satname)) // Optional popup with satellite name
        .addTo(map);
    });
  } else {
    console.log("No satellite data available to display.");
  }
</script>
